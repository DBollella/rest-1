<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Rest/Schema.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ExistentialQuantification #-}</span>
<a name="line-2"></a><span class='hs-comment'>-- | This module contains data types and combinators for defining a</span>
<a name="line-3"></a><span class='hs-comment'>-- 'Schema' for your 'Resource'. A 'Schema' has three type parameters,</span>
<a name="line-4"></a><span class='hs-comment'>-- specifying the identifiers for a single resource, a listing, and a</span>
<a name="line-5"></a><span class='hs-comment'>-- top-level (static) action. After routing, these identifiers will be</span>
<a name="line-6"></a><span class='hs-comment'>-- passed to the 'Handler'.</span>
<a name="line-7"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Rest</span><span class='hs-varop'>.</span><span class='hs-conid'>Schema</span>
<a name="line-8"></a>  <span class='hs-layout'>(</span> <span class='hs-comment'>-- * A set of combinators for creating schemas.</span>
<a name="line-9"></a>
<a name="line-10"></a>    <span class='hs-comment'>-- ** Top level</span>
<a name="line-11"></a>    <span class='hs-varid'>withListing</span>
<a name="line-12"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>noListing</span>
<a name="line-13"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>singleton</span>
<a name="line-14"></a>    <span class='hs-comment'>-- ** Named endpoints</span>
<a name="line-15"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>named</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>static</span>
<a name="line-17"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>single</span>
<a name="line-18"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>singleBy</span>
<a name="line-19"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>singleRead</span>
<a name="line-20"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listing</span>
<a name="line-21"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listingBy</span>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listingRead</span>
<a name="line-23"></a>    <span class='hs-comment'>-- ** Unnamed endpoints</span>
<a name="line-24"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>unnamedSingle</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>unnamedSingleRead</span>
<a name="line-26"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>unnamedListing</span>
<a name="line-27"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>unnamedListingRead</span>
<a name="line-28"></a>
<a name="line-29"></a>    <span class='hs-comment'>-- * The core schema data types.</span>
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Schema</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Step</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-33"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Cardinality</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-34"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Getter</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-35"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Id</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-36"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Endpoint</span>
<a name="line-37"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Rest</span><span class='hs-varop'>.</span><span class='hs-conid'>Dictionary</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ident</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Rest</span><span class='hs-varop'>.</span><span class='hs-conid'>Info</span> <span class='hs-layout'>(</span><span class='hs-conid'>Info</span><span class='hs-layout'>)</span>
<a name="line-41"></a>
<a name="line-42"></a><span class='hs-comment'>-- * A set of combinators for creating schemas.</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-comment'>-- ** Top level</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-comment'>-- | A schema with a top level listing.</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="withListing"></a><span class='hs-definition'>withListing</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>mid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Schema</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-49"></a><span class='hs-definition'>withListing</span> <span class='hs-varid'>mid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Schema</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Many</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-comment'>-- | A schema with no top level listing.</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="noListing"></a><span class='hs-definition'>noListing</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Schema</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-54"></a><span class='hs-definition'>noListing</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Schema</span> <span class='hs-conid'>Nothing</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-comment'>-- | A schema with a singleton at the top level.</span>
<a name="line-57"></a>
<a name="line-58"></a><a name="singleton"></a><span class='hs-definition'>singleton</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>sid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Schema</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-59"></a><span class='hs-definition'>singleton</span> <span class='hs-varid'>sid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Schema</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Single</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-60"></a>
<a name="line-61"></a><span class='hs-comment'>-- ** Named endpoints</span>
<a name="line-62"></a>
<a name="line-63"></a><span class='hs-comment'>-- | A list of named endpoints.</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="named"></a><span class='hs-definition'>named</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-66"></a><span class='hs-definition'>named</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Named</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-comment'>-- | A top level action endpoint for this resource.</span>
<a name="line-69"></a>
<a name="line-70"></a><a name="static"></a><span class='hs-definition'>static</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-71"></a><span class='hs-definition'>static</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span>
<a name="line-72"></a>
<a name="line-73"></a><span class='hs-comment'>-- | A singleton resource endpoint.</span>
<a name="line-74"></a>
<a name="line-75"></a><a name="single"></a><span class='hs-definition'>single</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>sid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-76"></a><span class='hs-definition'>single</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Single</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Singleton</span>
<a name="line-77"></a>
<a name="line-78"></a><span class='hs-comment'>-- | A single resource endpoint with a string identifier.</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="singleBy"></a><span class='hs-definition'>singleBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-81"></a><span class='hs-definition'>singleBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>singleIdent</span> <span class='hs-conid'>StringId</span>
<a name="line-82"></a>
<a name="line-83"></a><span class='hs-comment'>-- | A single resource endpoint with an identifier that can be read.</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="singleRead"></a><span class='hs-definition'>singleRead</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Info</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-86"></a><span class='hs-definition'>singleRead</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>singleIdent</span> <span class='hs-conid'>ReadId</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-comment'>-- | A single resource identified as specified by the 'Ident'.</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="singleIdent"></a><span class='hs-definition'>singleIdent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ident</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-91"></a><span class='hs-definition'>singleIdent</span> <span class='hs-varid'>ident</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Single</span> <span class='hs-varop'>.</span> <span class='hs-conid'>By</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>ident</span>
<a name="line-92"></a>
<a name="line-93"></a><span class='hs-comment'>-- | A listing endpoint.</span>
<a name="line-94"></a>
<a name="line-95"></a><a name="listing"></a><span class='hs-definition'>listing</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>mid</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-96"></a><span class='hs-definition'>listing</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Many</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Singleton</span>
<a name="line-97"></a>
<a name="line-98"></a><span class='hs-comment'>-- | A listing endpoint with a string identifier.</span>
<a name="line-99"></a>
<a name="line-100"></a><a name="listingBy"></a><span class='hs-definition'>listingBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-101"></a><span class='hs-definition'>listingBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listingIdent</span> <span class='hs-conid'>StringId</span>
<a name="line-102"></a>
<a name="line-103"></a><span class='hs-comment'>-- | A listing with an identifier that can be read.</span>
<a name="line-104"></a>
<a name="line-105"></a><a name="listingRead"></a><span class='hs-definition'>listingRead</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Info</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-106"></a><span class='hs-definition'>listingRead</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listingIdent</span> <span class='hs-conid'>ReadId</span>
<a name="line-107"></a>
<a name="line-108"></a><a name="listingIdent"></a><span class='hs-comment'>-- | A listing identified as specified by the 'Ident'.</span>
<a name="line-109"></a><span class='hs-definition'>listingIdent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ident</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-110"></a><span class='hs-definition'>listingIdent</span> <span class='hs-varid'>ident</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Many</span> <span class='hs-varop'>.</span> <span class='hs-conid'>By</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>ident</span>
<a name="line-111"></a>
<a name="line-112"></a><span class='hs-comment'>-- ** Unnamed endpoints</span>
<a name="line-113"></a>
<a name="line-114"></a><span class='hs-comment'>-- | An unnamed single resource with a string identifier.</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="unnamedSingle"></a><span class='hs-definition'>unnamedSingle</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-117"></a><span class='hs-definition'>unnamedSingle</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unnamedSingleIdent</span> <span class='hs-conid'>StringId</span>
<a name="line-118"></a>
<a name="line-119"></a><span class='hs-comment'>-- | An unnamed single resource with an identifier that can be read.</span>
<a name="line-120"></a>
<a name="line-121"></a><a name="unnamedSingleRead"></a><span class='hs-definition'>unnamedSingleRead</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Info</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-122"></a><span class='hs-definition'>unnamedSingleRead</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unnamedSingleIdent</span> <span class='hs-conid'>ReadId</span>
<a name="line-123"></a>
<a name="line-124"></a><span class='hs-comment'>-- | An unnamed single resource identified as specified by the</span>
<a name="line-125"></a><span class='hs-comment'>-- 'Ident'.</span>
<a name="line-126"></a>
<a name="line-127"></a><a name="unnamedSingleIdent"></a><span class='hs-definition'>unnamedSingleIdent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ident</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-128"></a><span class='hs-definition'>unnamedSingleIdent</span> <span class='hs-varid'>ident</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Unnamed</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Single</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>ident</span>
<a name="line-129"></a>
<a name="line-130"></a><span class='hs-comment'>-- | An unnamed listing with a string identifier.</span>
<a name="line-131"></a>
<a name="line-132"></a><a name="unnamedListing"></a><span class='hs-definition'>unnamedListing</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-133"></a><span class='hs-definition'>unnamedListing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unnamedListingIdent</span> <span class='hs-conid'>StringId</span>
<a name="line-134"></a>
<a name="line-135"></a><a name="unnamedListingRead"></a><span class='hs-comment'>-- | An unnamed listing with an identifier that can be read.</span>
<a name="line-136"></a><span class='hs-definition'>unnamedListingRead</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Info</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-137"></a><span class='hs-definition'>unnamedListingRead</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unnamedListingIdent</span> <span class='hs-conid'>ReadId</span>
<a name="line-138"></a>
<a name="line-139"></a><span class='hs-comment'>-- | An unnamed listing identified as specified by the 'Ident'.</span>
<a name="line-140"></a>
<a name="line-141"></a><a name="unnamedListingIdent"></a><span class='hs-definition'>unnamedListingIdent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ident</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span>
<a name="line-142"></a><span class='hs-definition'>unnamedListingIdent</span> <span class='hs-varid'>ident</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Unnamed</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Many</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>ident</span>
<a name="line-143"></a>
<a name="line-144"></a><span class='hs-comment'>-- * The core schema data types.</span>
<a name="line-145"></a>
<a name="line-146"></a><span class='hs-comment'>-- | A 'Schema' describes how (part of the) route to a resource looks,</span>
<a name="line-147"></a><span class='hs-comment'>-- and returns an identifier for a single resource ('sid'), many</span>
<a name="line-148"></a><span class='hs-comment'>-- resources ('mid') or a static action ('aid').</span>
<a name="line-149"></a><span class='hs-comment'>-- The first argument specifies the top level resource (no path</span>
<a name="line-150"></a><span class='hs-comment'>-- segments). The second specifies a what happens at the first step in</span>
<a name="line-151"></a><span class='hs-comment'>-- the path.</span>
<a name="line-152"></a>
<a name="line-153"></a><a name="Schema"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Schema</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Schema</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cardinality</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span><span class='hs-layout'>)</span>
<a name="line-154"></a>
<a name="line-155"></a><span class='hs-comment'>-- | A step in the routing of a resource. A part of the uri either</span>
<a name="line-156"></a><span class='hs-comment'>-- identifies a 'Named' resource, or an 'Unnamed' resource. Named</span>
<a name="line-157"></a><span class='hs-comment'>-- resources can be static actions ('Left') or one or many singletons or</span>
<a name="line-158"></a><span class='hs-comment'>-- by's.</span>
<a name="line-159"></a>
<a name="line-160"></a><a name="Step"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Step</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Named</span>   <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-161"></a>                      <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Unnamed</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cardinality</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-162"></a>
<a name="line-163"></a><a name="Cardinality"></a><span class='hs-comment'>-- | Specifies if we're identifying a single resource, or many (a</span>
<a name="line-164"></a><a name="Cardinality"></a><span class='hs-comment'>-- listing).</span>
<a name="line-165"></a><a name="Cardinality"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Cardinality</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Single</span> <span class='hs-varid'>s</span>
<a name="line-166"></a>                     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Many</span>   <span class='hs-varid'>m</span>
<a name="line-167"></a>
<a name="line-168"></a><span class='hs-comment'>-- | A 'Getter' can either be a 'Singleton' (there is only one) or it</span>
<a name="line-169"></a><span class='hs-comment'>-- can be identified 'By' an 'Id'entifier.</span>
<a name="line-170"></a>
<a name="line-171"></a><a name="Getter"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Getter</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Singleton</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>By</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-172"></a>
<a name="line-173"></a><span class='hs-comment'>-- | An identification of an item in a resource. It contains a</span>
<a name="line-174"></a><span class='hs-comment'>-- dictionary describing how to identify the resource, and a function</span>
<a name="line-175"></a><span class='hs-comment'>-- for this identification type to an @id@.</span>
<a name="line-176"></a>
<a name="line-177"></a><a name="Id"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Id</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>Id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ident</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-178"></a>
<a name="line-179"></a><span class='hs-comment'>-- | A named endpoint: an static action, a single item of many items.</span>
<a name="line-180"></a>
<a name="line-181"></a><a name="Endpoint"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Endpoint</span> <span class='hs-varid'>sid</span> <span class='hs-varid'>mid</span> <span class='hs-varid'>aid</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Either</span> <span class='hs-varid'>aid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Cardinality</span> <span class='hs-layout'>(</span><span class='hs-conid'>Getter</span> <span class='hs-varid'>sid</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Getter</span> <span class='hs-varid'>mid</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre></body>
</html>
